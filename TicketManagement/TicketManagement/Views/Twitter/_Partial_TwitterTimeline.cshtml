@using TicketManagement.ViewModels
@model IEnumerable<TwitterTweetViewModel>

@if (Model == null)
{
    <p>Please check that you have associated your account with Twitter</p>
}
else
{
    <div>
        @foreach (TwitterTweetViewModel tweet in Model)
        {
            <div class="list-group panel">

                @if (tweet.Replies.Count < 1) // If there are no replies just display the basic Panel
                {
                    <p class="list-group-item list-group-item-info one-line" style="white-space: nowrap">
                        <strong>@tweet.Text</strong>
                        @if (tweet.TicketRequest)
                        {
                            @Html.ActionLink("Create Ticket", "Index", "Tickets", new { id = tweet.TwitterId }, new { @class = "one_line" })
                        }
                    </p>
                }
                else
                {
                    string tweetId = $"#{tweet.TwitterId}";
                    <p class="list-group-item list-group-item-info one-line" style="white-space: nowrap">
                        <a href="@tweetId" class="one-line" data-toggle="collapse" data-parent="@tweetId"><i class="fa fa-caret-down"></i></a>
                        <strong>@tweet.Text</strong>
                        @if (tweet.TicketRequest)
                        {
                            @Html.ActionLink("Create Ticket", "Index", "Tickets", new { id = tweet.TwitterId }, new { @class = "one_line" })
                        }
                    </p>
                    
                    <div class="collapse" id="@tweet.TwitterId">
                        @foreach (TwitterTweetViewModel tweetReply in tweet.Replies)
                        {
                            @HandleTwitterTweetViewModels(tweetId, tweetReply)
                        }
                    </div>
                }
            </div>
        }
    </div>
}

@helper HandleTwitterTweetViewModels(string parentId, TwitterTweetViewModel vm)
{

string tweetId = $"#{vm.TwitterId}";

    if (vm.Replies.Count < 1) // If there are no replies just display the basic Panel
    {
        <a href="#" class="list-group-item" data-parent="@parentId">@vm.Text</a>
    }
    else
    {
        <p class="list-group-item one-line" style="white-space: nowrap">
            <a href="@tweetId" class="one-line" data-toggle="collapse" data-parent="@parentId"><i class="fa fa-caret-down"></i></a>
             @vm.Text
            @if (vm.TicketRequest)
            {
                @Html.ActionLink("Create Ticket", "Index", "Tickets", new { id = vm.TwitterId }, new { @class = "one_line" })
            }
        </p>
        <div class="collapse list-group-submenu" id="@vm.TwitterId" style="margin-left: 20px">

            @foreach (TwitterTweetViewModel tweetReply in vm.Replies)
            {
                @HandleTwitterTweetViewModels(tweetId, tweetReply)
            }
        </div>
    }
}

<style type="text/css">
        .list-group.panel > .list-group-item {
            border-bottom-right-radius: 4px;
            border-bottom-left-radius: 4px;
        }

        .one-line {
            white-space: nowrap;
        }

        .list-group-submenu {
            margin-left: 20px;
        }
    </style>